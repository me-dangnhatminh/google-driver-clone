datasource db {
  provider = "postgresql"
  url      = env("DB_URL")
}

generator client {
  provider = "prisma-client-js"
}

// ---------------- Billing service ---------------- //
model PlanCategory {
  id          String  @id
  name        String  @unique @map("name")
  description String? @map("description")
  plans       Plan[]
}

model Plan {
  id         String        @id
  categoryId String        @map("category_id")
  name       String        @map("name")
  price      String        @map("price")
  currency   String        @map("currency")
  duration   String        @map("duration")
  metadata   Json?         @map("metadata")
  category   PlanCategory? @relation(fields: [categoryId], references: [id])
}

model Invoice {
  id             String   @id
  subscriptionId String   @map("subscription_id")
  amount         String   @map("amount")
  currency       String   @map("currency")
  status         String   @map("status")
  issueDate      DateTime @map("issue_date") @db.Timestamp()
  dueDate        DateTime @map("due_date") @db.Timestamp()
  metadata       Json?    @map("metadata")
}

model Subscription {
  id        String   @id
  accountId String   @map("account_id")
  planId    String   @map("plan_id")
  status    String   @map("status") // active, inactive 
  startDate DateTime @map("start_date") @db.Timestamp()
  endDate   DateTime @map("end_date") @db.Timestamp()
  metadata  Json?    @map("metadata")
}

// ---------------- Payment service ---------------- //

model PaymentEvent {
  checkoutId     String  @id
  buyerInfo      String
  sellerInfo     String
  creditCardInfo String
  isPaid         Boolean
}

model PaymentOrder {
  paymentOrderId String  @id
  buyerAccountId String
  amount         String
  currency       String
  checkoutId     String
  status         String // not_started, executing, success, failed
  ledgerUpdated  Boolean
  walletUpdated  Boolean
}
